{% extends 'base.html' %}
{% block content %}
<style type="text/css">
	#map {
		height: 100%;
	}

	.fab {
		position: fixed;
		bottom: 20px;
		left: 30%;
		z-index: 99;
		border-radius: 50px;
		/*left: auto !important;*/
	}

	@media (min-width: 576px) {
		.fab {
			left: 35%;
		}
	}

	@media (min-width: 768px) {
		.fab {
			left: 37%;
		}
	}

	@media (min-width: 992px) {
		.fab {
			left: 41%;
		}
	}

	@media (min-width: 1200px) {
		.fab {
			left: 43%;
		}
	}
</style>
<div class="containere mt-5">
	<nav aria-label="breadcrumb">
		<ol class="breadcrumb">
			<li class="breadcrumb-item"><a class="text-danger" href="{% url 'index' %}">Home</a></li>
			<li class="breadcrumb-item active" aria-current="page">Post Ad</li>
		</ol>
	</nav>
	<div class="col-md-6 offset-md-3">
		<form method="POST" enctype="multipart/form-data">
			<input type="hidden" name="longitude" id="longitude" value="{{ form.longitude.value}}">
			<input type="hidden" name="latitude" id="latitude" value="{{ form.latitude.value}}">
			<div class="form-group">
				<label for="propertyPhoto"><strong>Add a photo</strong></label>
				<input type="file" class="form-control-file" id="propertyPhoto" name="image">
			</div>
			<div class="form-group">
				<label for="propertyAddres"><strong>Property Address</strong></label>
				<input type="text" class="form-control" name="address" value="{{form.address.value}}"
					placeholder="Your Property Address" id="pac-input">
			</div>
			<div class="form-group">
				<label for="propertytitle"><strong>Property Title</strong></label>
				<input type="text" class="form-control" id="propertytitle" name="title"
					placeholder="Your Property Title">
			</div>
			<div class="form-group">
				<label for="propertyDescription"><strong>Describe more about your property</strong></label>
				<textarea class="form-control" id="propertyDescription" name="description" rows="3"
					placeholder="Enter any notes here..."></textarea>
			</div>
			{% csrf_token %}
			{% if form.errors %}
			<!-- Error messaging -->
			<div id="errors" class="alert alert-danger" role="alert">
				<div class="inner">
					<p>There were some errors in the information you entered. Please correct the following:</p>
					{{ form.non_field_errors }}
					<ul>
						{% for field in form %}
						{% if field.errors %}<li>{{ field.label }}: {{ field.errors|striptags }}</li>{% endif %}
						{% endfor %}
					</ul>
				</div>
			</div>
			<!-- /Error messaging -->
			{% endif %}
			<div class="form-group">
				<input type="submit" class="btn btn-danger" value="Save">
			</div>
		</form>
	</div>

	<div id="map"></div>
	<div id="infowindow-content">
		<img src="" width="16" height="16" id="place-icon">
		<span id="place-name" class="title"></span><br>
		<span id="place-address"></span>
	</div>
	<script>
		// Initialize and add the map
		function initAutocomplete() {
			var map = new google.maps.Map(document.getElementById('map'), {
				center: { lat: -33.8688, lng: 151.2195 },
				zoom: 13
			});
			var card = document.getElementById('pac-card');
			var input = document.getElementById('pac-input');
			var types = document.getElementById('type-selector');
			var strictBounds = document.getElementById('strict-bounds-selector');
			map.controls[google.maps.ControlPosition.TOP_RIGHT].push(card);
			var autocomplete = new google.maps.places.Autocomplete(input);
			// Bind the map's bounds (viewport) property to the autocomplete object,
			// so that the autocomplete requests use the current map bounds for the
			// bounds option in the request.
			autocomplete.bindTo('bounds', map);
			// Set the data fields to return when the user selects a place.
			autocomplete.setFields(
				['address_components', 'geometry', 'icon', 'name']);
			var infowindow = new google.maps.InfoWindow();
			var infowindowContent = document.getElementById('infowindow-content');
			infowindow.setContent(infowindowContent);
			var marker = new google.maps.Marker({
				map: map,
				anchorPoint: new google.maps.Point(0, -29)
			});
			autocomplete.addListener('keydown', function (event) {
				if (event.keyCode === 13) {
					event.preventDefault();
				}
			});
			autocomplete.addListener('place_changed', function () {
				infowindow.close();
				marker.setVisible(false);
				var place = autocomplete.getPlace();
				if (!place.geometry) {
					// User entered the name of a Place that was not suggested and
					// pressed the Enter key, or the Place Details request failed.
					window.alert("No details available for input: '" + place.name + "'");
					return;
				}
				// If the place has a geometry, then present it on a map.
				if (place.geometry.viewport) {
					map.fitBounds(place.geometry.viewport);
				} else {
					map.setCenter(place.geometry.location);
					map.setZoom(17);  // Why 17? Because it looks good.
				}
				marker.setPosition(place.geometry.location);
				marker.setVisible(true);
				var address = '';
				if (place.address_components) {
					address = [
						(place.address_components[0] && place.address_components[0].short_name || ''),
						(place.address_components[1] && place.address_components[1].short_name || ''),
						(place.address_components[2] && place.address_components[2].short_name || '')
					].join(' ');
				}
				infowindowContent.children['place-icon'].src = place.icon;
				infowindowContent.children['place-name'].textContent = place.name;
				infowindowContent.children['place-address'].textContent = address;
				infowindow.open(map, marker);
				console.log(place.name + "," + address, place.geometry.location.lat(), place.geometry.location.lng())
				document.getElementById("pac-input").value = place.name + "," + address
				document.getElementById("longitude").value = place.geometry.location.lng()
				document.getElementById("latitude").value = place.geometry.location.lat()
			});
			// Sets a listener on a radio button to change the filter type on Places
			// Autocomplete.
			// function setupClickListener(id, types) {
				// var radioButton = document.getElementById(id);
				// radioButton.addEventListener('click', function () {
					// autocomplete.setTypes(types);
				// });
			// }
			// setupClickListener('changetype-all', []);
			// setupClickListener('changetype-address', ['address']);
			// setupClickListener('changetype-establishment', ['establishment']);
			// setupClickListener('changetype-geocode', ['geocode']);
			// document.getElementById('use-strict-bounds')
				// .addEventListener('click', function () {
					// console.log('Checkbox clicked! New state=' + this.checked);
					// autocomplete.setOptions({ strictBounds: this.checked });
				// });
		}
	</script>
	<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAPRZuH5Yd90AeVIR-R_t6ySZeIrWn2OzQ&libraries=places&callback=initAutocomplete"
		async defer></script>
</div>
{% endblock %}